name: Lib - Build & Test

on: 
  workflow_call:
    secrets:
      github-token:
        description: 'The GitHub PAT token to perform checkout and publish.'
        required: true
      cache-version:
        description: 'The Cache version.'
        required: true
    inputs:
      sln-file:
        description: 'The name of the project to build. Must match the directory name.'
        required: true
        type: string
        
jobs:
  build:
    runs-on:
      group: linux-runners

    steps:
    - name: ðŸ›Ž Checkout
      uses: actions/checkout@v6
    - name: ðŸ“¦ Cache
      uses: actions/cache@v4
      with:
        path: ~/.nuget/packages
        key: nuget-${{ secrets.cache-version }}-${{ hashFiles('**/*.csproj') }}
        restore-keys: |
          nuget-${{ secrets.cache-version }}-
    - name: âž• Add nugets source
      run: dotnet nuget add source https://nuget.pkg.github.com/unosquare/index.json -n github -u unosquare -p ${{ secrets.github-token }} --store-password-in-clear-text
    - name: Build and analyze
      run: |
        dotnet build -c Release ${{ inputs.sln-file }} -p:WarningLevel=0
    - name: Run tests
      run: |
        dotnet test ${{ inputs.sln-file }}
